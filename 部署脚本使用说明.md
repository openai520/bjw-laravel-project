# 自动化部署脚本使用说明

## 脚本介绍

为了提高开发效率，避免重复手动操作，我们提供了两个自动化部署脚本：

### 1. `deploy.sh` - 完整部署脚本 🚀

**适用场景**: 重大更新、新功能发布、生产环境部署

**功能特性**:
- ✅ 完整的Git操作（add、commit、push）
- ✅ 上传所有关键目录（app、resources、config、routes）
- ✅ 服务器端缓存清除和优化
- ✅ 文件权限设置
- ✅ 部署状态验证
- ✅ 详细的步骤提示和错误处理

**使用方法**:
```bash
# 方式1: 脚本会提示输入提交信息
./deploy.sh

# 方式2: 直接传入提交信息
./deploy.sh "修复购物车性能问题"
```

### 2. `quick-deploy.sh` - 快速部署脚本 ⚡

**适用场景**: 日常小更新、样式调整、Bug修复

**功能特性**:
- ✅ 快速Git三连击（add、commit、push）
- ✅ 上传核心文件（app、resources/views）
- ✅ 基础缓存清除
- ✅ 简洁的输出信息
- ✅ 快速执行（约30秒完成）

**使用方法**:
```bash
# 方式1: 使用默认提交信息（含时间戳）
./quick-deploy.sh

# 方式2: 自定义提交信息
./quick-deploy.sh "更新产品模态框样式"
```

## 部署流程说明

### 完整部署流程 (`deploy.sh`)
1. **Git操作**: 添加更改 → 提交 → 推送到GitHub
2. **文件上传**: 上传app、resources、config、routes目录到服务器
3. **服务器优化**: 
   - 清除所有缓存（cache、config、route、view）
   - 重新生成优化缓存
   - 设置正确的文件权限
4. **验证部署**: 检查网站可访问性
5. **显示结果**: 详细的部署报告

### 快速部署流程 (`quick-deploy.sh`)
1. **Git操作**: 一键提交并推送
2. **文件上传**: 上传关键文件到服务器
3. **清除缓存**: 基础缓存清理
4. **完成反馈**: 简洁的成功信息

## 服务器配置

当前配置的服务器信息：
- **服务器**: `root@43.165.63.73`
- **网站路径**: `/www/wwwroot/kalala.me`
- **SSH密钥**: `~/Desktop/sursor.pem`
- **网站地址**: https://kalala.me

## 使用建议

### 📅 日常开发建议使用 `quick-deploy.sh`
- 样式调整
- 文本更改
- 小功能优化
- Bug修复

### 🎯 重要更新建议使用 `deploy.sh`
- 新功能发布
- 数据库结构更改
- 配置文件更新
- 路由结构调整

## 注意事项

1. **首次使用前确保**:
   - SSH密钥路径正确
   - 有服务器访问权限
   - Git仓库配置正确

2. **数据库更改**:
   - 脚本不会自动运行数据库迁移
   - 如有数据库更改，需手动执行：
     ```bash
     ssh -i ~/Desktop/sursor.pem root@43.165.63.73 "cd /www/wwwroot/kalala.me && php artisan migrate"
     ```

3. **环境变量更改**:
   - `.env`文件不会自动上传
   - 如需更新环境变量，请手动操作

4. **大文件上传**:
   - 脚本不上传`storage`、`vendor`等大目录
   - 如需更新这些目录，请手动处理

## 故障排除

### 常见问题

**Q: Git推送失败**
A: 检查网络连接和Git凭据，确保有推送权限

**Q: SSH连接失败**
A: 检查SSH密钥路径和服务器连接状态

**Q: 文件上传失败**
A: 检查服务器磁盘空间和权限设置

**Q: 缓存清除失败**
A: 检查服务器上PHP和Artisan是否正常工作

### 调试模式

如需查看详细的执行过程，可以使用：
```bash
bash -x ./deploy.sh "调试模式部署"
```

## 性能优化

使用这些脚本后，您的部署时间将：
- **从**: 手动操作需要3-5分钟
- **到**: 自动脚本30秒-2分钟完成

大幅提升开发效率！🎉 